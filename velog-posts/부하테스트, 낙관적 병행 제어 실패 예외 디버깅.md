<p>cafeboo ì„œë¹„ìŠ¤ v1 ë°°í¬ê°€ ëë‚¬ë‹¤.</p>
<p>v1 ë°°í¬ëŠ” ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ê¸°ë°˜ì˜ ê°„ë‹¨í•œ í´ë¼ìš°ë“œ ì•„í‚¤í…ì²˜ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/c0a1ce4d-9cd2-4507-967d-2761275d0950/image.png" /></p>
<p>ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ì•ˆì— FE, BE, AI, DBê°€ ëª¨ë‘ ë“¤ì–´ê°€ ìˆê¸° ë•Œë¬¸ì— ë¶€í•˜í…ŒìŠ¤íŠ¸ì— ì¢‹ì§€ ëª»í•œ ì„±ëŠ¥ì„ ë³´ì¼ê²ƒìœ¼ë¡œ ì˜ˆìƒëœë‹¤. 
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/28d01a8f-f3a2-4fcd-b9ac-0363f7575d83/image.png" /></p>
<p>ë¶€í•˜í…ŒìŠ¤íŠ¸ ë„êµ¬ë¡œëŠ” Jmeterë¥¼ ì‚¬ìš©í–ˆë‹¤.
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/4e63a43c-f782-4207-b221-c53bd6687358/image.png" /></p>
<h3 id="thread-ê·¸ë£¹-ìƒì„±">Thread ê·¸ë£¹ ìƒì„±</h3>
<p>Test Plan -&gt; Add -&gt; Threads(Users) -&gt; Thread Group
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/5e1954a0-d959-496b-99c2-a42393ba9ef5/image.png" /></p>
<ul>
<li>Number of Threads(Users): ìŠ¤ë ˆë“œ ìˆ˜ (ìœ ì € ìˆ˜)</li>
<li>Ramp-up period (seconds): ì§€ì •ëœ ìœ ì €ê°€ ëª¨ë‘ ë¡œë”©ë  ì‹œê°„</li>
<li>Loop Count: ë°˜ë³µ íšŸìˆ˜
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/02b695a3-2e32-45c4-95e1-5b1224c6f654/image.png" /></li>
</ul>
<p>1ì´ˆì— 50ë²ˆì˜ ë¶€í•˜ë¥¼ 100ë²ˆ, ì´ 5000ê±´ì˜ ìš”ì²­ì„ ë°œìƒì‹œì¼°ë‹¤.</p>
<h3 id="sampler-ìƒì„±">Sampler ìƒì„±</h3>
<p>Test Plan -&gt; Add -&gt; Sampler -&gt; HTTP Request
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/5cb3c8e8-2e8d-4f72-9899-7aecd13c6319/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/0b1cbdd6-68c9-4809-bacb-ca707dcce662/image.png" /></p>
<h4 id="post-ìš”ì²­ì‹œ-ì¶”ê°€-ì„¤ì •">POST ìš”ì²­ì‹œ ì¶”ê°€ ì„¤ì •</h4>
<p>Postë¡œ ìš”ì²­ì‹œì—ëŠ” HTTP Header ì„¤ì •ì„ ì¶”ê°€ë¡œ í•´ì£¼ì–´ì•¼ í•œë‹¤.
Sampler -&gt; Add -&gt; Config Element -&gt; HTTP Header Manager</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/8875b901-56d2-439f-a56f-dc3cbbde0ba3/image.png" /></p>
<p>Addë¥¼ í´ë¦­í•˜ì—¬ Content-type: application/json ê°’ì„ ë„£ì–´ì¤€ë‹¤.
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/f63990f0-d764-4034-9a89-3825fa53ec17/image.png" /></p>
<p>ë¡œê·¸ì¸ ì´í›„ ë¡œì§ì´ê¸°ì— Bearer Token ë„ ê°™ì´ ë„£ì–´ì¤€ë‹¤.
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/af2dcf78-cdd7-4c3f-b095-b5e4fa75027a/image.png" /></p>
<h3 id="listner-ì¶”ê°€">Listner ì¶”ê°€</h3>
<p>Thread Group -&gt; Add -&gt; Listner -&gt; ì›í•˜ëŠ” í˜•ì‹ ì¶”ê°€</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/e1caa23c-d40b-49b7-abf3-961fa48e9a38/image.png" /></p>
<p>ìš°ì„  ê²°ê³¼ë¬¼ì„ ê·¸ë˜í”„ í˜•íƒœë¡œ ì‹œê°í™”í•´ì„œ ë³´ì—¬ì£¼ëŠ” <strong>Aggregate Graph</strong> ì™€ í†µê³„ í…Œì´ë¸”ì„ ì œê³µí•´ì£¼ëŠ” <strong>Summary Report</strong> ë¥¼ ë¦¬ìŠ¤ë„ˆë¡œ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/91d7b9a0-21e7-4d88-8141-4181b3a27bb4/image.png" /></p>
<h2 id="í…ŒìŠ¤íŠ¸">í…ŒìŠ¤íŠ¸</h2>
<p>v1ì— í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ apië“¤ì„ êµ¬ì„±í•œ í›„, ê° api ë§ˆë‹¤ 1ë²ˆì”© ìš”ì²­ì„ í•´ë³´ì•˜ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/9f9d1e3e-10a4-4454-971f-ade573189502/image.png" /></p>
<p>ë¶€í•˜í…ŒìŠ¤íŠ¸ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/681bce08-daa9-4f63-baed-02ea2f1d1d5b/image.png" /></p>
<p>í‰ê·  ì‘ë‹µ ì‹œê°„ì´ 144msë¡œ ì•„ì§ì€ 1ê±´ì”©ì˜ ìš”ì²­ì´ë¼ ì‘ë‹µì´ ë§¤ìš° ë¹ ë¦„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/5592669a-7fb8-483f-81f3-5b96b4c69be7/image.png" /></p>
<p>apië³„ ì‘ë‹µì€ ì¹´í˜ì¸ ì„­ì·¨ ë“±ë¡ì´ 576 ms ë¡œ ê°€ì¥ ëŠë ¸ê³ , ë‹¨ìˆœ ì¡°íšŒ apiëŠ” 100ms ì´í•˜ë¡œ ë‚˜íƒ€ë‚¨</p>
<p>ì´ë²ˆì—” 5ëª…ì˜ ìœ ì €ê°€ 5íšŒ ìš”ì²­ì„ ë³´ë‚´ë„ë¡ í•´ë³´ì•˜ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/8323ea45-3bb7-42cd-ac4b-afa090150ea6/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/59088b4f-4538-4d21-a264-36c8d8095755/image.png" /></p>
<p>ì´ë²ˆì—ë„ ë‹¨ìˆœ ì¡°íšŒìš”ì²­ì€ 100ms ì´í•˜ë¡œ ë‚˜íƒ€ë‚¬ì§€ë§Œ, ë“±ë¡ê³¼ ê°™ì€ ìš”ì²­ì€ 1000ms ì´ìƒìœ¼ë¡œ 1ê±´ì˜ ìš”ì²­ë³´ë‹¤ ì‘ë‹µì‹œê°„ì´ ëŠ˜ì–´ë‚¬ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/bee3d251-dace-40e1-b2d3-ee76e2362ca9/image.png" /></p>
<p>ë“±ë¡ ìš”ì²­ì˜ í¸ì°¨ë„ ëŠ˜ì–´ë‚œ ê²ƒì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/f650e858-b9e0-4da0-846f-4bd09ae74361/image.png" /></p>
<p>ì´ë²ˆì—” Threadë¥¼ 50ìœ¼ë¡œ ëŠ˜ë ¤ë³´ì•˜ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/482f5740-1236-4f60-87f6-16b962cb6aa8/image.png" /></p>
<p>ì „ì²´ í‰ê·  ì‘ë‹µì‹œê°„ì´ 1626ms, ì„±ëŠ¥ í‘œì¤€í¸ì°¨ê°€ 800~1600ms ìˆ˜ì¤€ìœ¼ë¡œ ë°œìƒí–ˆìœ¼ë©° ìœ ì € ì¹´í˜ì¸ì •ë³´ ìˆ˜ì • apiëŠ” 18.4% ì˜ ì—ëŸ¬ìœ¨ì„ ë³´ì—¬ì¤¬ë‹¤.</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/3eb7e361-3afb-4526-8b61-c1a27207d3fb/image.png" /></p>
<p>ë¡œê·¸ë¥¼ í™•ì¸í•´ ë³´ë‹ˆ ì•„ë˜ì™€ ê°™ì•˜ë‹¤.</p>
<pre><code class="language-java">org.springframework.orm.ObjectOptimisticLockingFailureException: Row was updated or deleted by another transaction (or unsaved-value mapping was incorrect): [com.ktb.cafeboo.domain.user.model.UserFavoriteDrinkType#1081]
    at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:329)
    at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:256)
    at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:244)
    at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:566)
    at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:795)
    at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:758)
    at 
 ... ì´í•˜ ìƒëµ
</code></pre>
<p>í•´ë‹¹ ì˜ˆì™¸ëŠ” ë™ì¼í•œ ì—”í‹°í‹°(ê°™ì€ ID)ë¥¼ ë‘ ê°œ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì´ ë™ì‹œì— ìˆ˜ì •í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•œë‹¤.</p>
<p>ìœ ì € ì¹´í˜ì¸ ì •ë³´ ìˆ˜ì • apiëŠ” ì•„ë˜ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œë‹¤.</p>
<pre><code class="language-java">// domain/user/model/User.java

public void setFavoriteDrinks(List&lt;UserFavoriteDrinkType&gt; favorites) {
        this.favoriteDrinks.clear(); // ê¸°ì¡´ ê´€ê³„ ì œê±°
        this.favoriteDrinks.addAll(favorites);
    }</code></pre>
<p>ê²‰ë³´ê¸°ì—ëŠ” ë‹¨ìˆœíˆ listë¥¼ clear í•˜ê³  ì¶”ê°€í•˜ëŠ” updateì™€ ë™ì¼í•œ ë¡œì§ì²˜ëŸ¼ ë³´ì¸ë‹¤. </p>
<pre><code class="language-java">@OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL, orphanRemoval = true)
    private List&lt;UserFavoriteDrinkType&gt; favoriteDrinks = new ArrayList&lt;&gt;();</code></pre>
<p>í•˜ì§€ë§Œ <strong>favoriteDrinks</strong>ëŠ” <strong><code>cascade</code></strong> ì˜µì…˜ì´ ë¶™ì–´ìˆì–´ì„œ, ì‹¤ì œë¡œëŠ” ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ë¬¸ì„ ì‹¤í–‰í•œë‹¤.</p>
<pre><code class="language-sql">DELETE FROM user_favorite_drink_types WHERE user_id = ?;</code></pre>
<p>ì¦‰, ë‹¨ìˆœ ì»¬ë ‰ì…˜ clearê°€ ì•„ë‹ˆë¼ <strong>ì—”í‹°í‹° ì œê±°</strong>ë¡œ í•´ì„ëœë‹¤.</p>
<p>ì •ë¦¬í•˜ìë©´ <strong>ë‚™ê´€ì  ë³‘í–‰ì œì–´ ì‹¤íŒ¨(ObjectOptimisticLockingFailureException)</strong>ê°€ ë°œìƒí•˜ëŠ” íë¦„ì€ ì•„ë˜ì™€ ê°™ë‹¤.</p>
<ol>
<li><strong>ì¹´í˜ì¸ ì •ë³´ ìˆ˜ì • api</strong>ê°€ í˜¸ì¶œë˜ì–´ clear() í˜¸ì¶œ</li>
<li>clear() ëŠ” í•´ë‹¹ rowì— ëŒ€í•´ <strong>DELETE ì¿¼ë¦¬ ì‹¤í–‰ ì˜ˆì•½</strong></li>
<li>ë™ì‹œì— ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ë™ì¼ user_idë¡œ <strong>clear() í˜¸ì¶œ</strong></li>
<li>ì²˜ìŒ íŠ¸ëœì­ì…˜ì´ ë¨¼ì € <strong>commit í•˜ì—¬ í•´ë‹¹ rowë¥¼ ì‚­ì œ</strong></li>
<li>ë‘ë²ˆì§¸ íŠ¸ëœì­ì…˜ì´ clear()ë¡œ ì¸í•´ <code>DELETE FROM user_favorite_drink_types WHERE id = 123</code> ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰</li>
<li>ê·¸ëŸ¬ë‚˜ ì´ rowëŠ” ì‚­ì œë˜ì—ˆê¸°ì—, <strong>Hibernate</strong>ëŠ” ë°ì´í„°ê°€ ì˜ˆìƒ ìƒíƒœì™€ ë‹¤ë¥´ë‹¤ íŒë‹¨í•˜ê³  <strong>ë‚™ê´€ì  ë³‘í–‰ì œì–´ ì‹¤íŒ¨ ì˜ˆì™¸ë¥¼ ë°œìƒ</strong>ì‹œí‚´</li>
</ol>
<p>í˜„ì¬ ìƒíƒœì—ì„œ ìš”ì²­ ê³¼ë¶€í™”ë¥¼ ë” ë†’ì—¬ë³´ì.</p>
<p>Thread 200</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/d493da6c-9b33-4214-a95f-1c5f851431cf/image.png" />
<img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/7d52ab05-e5cb-405f-b036-ccdf48026bfb/image.png" /></p>
<ul>
<li>ì´ ìš”ì²­ ìˆ˜: 14,000 ê±´</li>
<li>ì „ì²´ API í‰ê·  ì‘ë‹µ ì‹œê°„: 8017ms</li>
<li>ì´ ì²˜ë¦¬ëŸ‰ 23.9 req/sec</li>
</ul>
<p>Thread 500</p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/668922e5-d32e-472a-90ff-39ddbb78b38c/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/d0456130-f869-47ae-a5a4-cc02ed04a98a/image.png" /></p>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/d897d2e8-4dae-48ad-adad-082938a6f1ce/image.png" /></p>
<ul>
<li>ì´ 70,138 ê±´ì˜ ìš”ì²­ ì²˜ë¦¬</li>
<li>ì „ì²´ í‰ê·  ì‘ë‹µ ì‹œê°„: 14.05 ì´ˆ</li>
<li>ì „ì²´ ì—ëŸ¬ìœ¨: 21.92%</li>
<li>ì´ ì²˜ë¦¬ëŸ‰ 25.7 req/sec</li>
</ul>
<p>API ì—ì„œ ë°œìƒí•œ ì—ëŸ¬ë¡œ ì¸í•´ ë‹¤ë¥¸ API ì—ì„œë„ ì—ëŸ¬ìœ¨ì´ ì¦ê°€í•˜ê³ , ì‘ë‹µ ì‹œê°„ì´ í¬ê²Œ ëŠ˜ì—ˆë‹¤.</p>
<p>íŠ¸ëœì­ì…˜ì´ ì˜¤ë˜ ê±¸ë¦¼ìœ¼ë¡œ ì¸í•´, <strong>ì»¤ë„¥ì…˜ í’€ ì ìœ  ì‹œê°„ì´ ì¦ê°€</strong>í•˜ê³  ê°™ì€ ì‹œì ì— ë§ì€ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ <strong>DB ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ</strong> -&gt; ë‹¤ë¥¸ APIë„ DB ì ‘ê·¼ì„ ëª»í•´ì„œ <strong>ëŠë ¤ì§ or 500 ì—ëŸ¬ ë°œìƒ</strong></p>
<p><code>tomcat</code> ìŠ¤ë ˆë“œê°€ ì¥ê¸°ê°„ ì ìœ ë˜ë©´ì„œ ì •ìƒ API ìš”ì²­ë„ ìŠ¤ë ˆë“œë¥¼ ë°°ì •ë°›ê¸° ëª»í•´ì„œ <strong>timeout ë°œìƒ</strong></p>
<h3 id="ğŸ’¡ì»¤ë„¥ì…˜-í’€ì´ë€">ğŸ’¡ì»¤ë„¥ì…˜ í’€ì´ë€?</h3>
<p>DBì— ì ‘ê·¼í•˜ë ¤ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ì™€ì˜ <strong>ì—°ê²°(Connection)</strong>ì´ í•„ìš”í•˜ë‹¤.
í•˜ì§€ë§Œ ë§¤ë²ˆ ì—°ê²°ì„ ë§Œë“¤ê³  ëŠëŠ” ê²ƒì€ ë§¤ìš° ë¹„ì‹¸ê³  ì‹œê°„ë„ ì˜¤ë˜ê±¸ë¦¬ê¸°ì— <strong>&quot;ë¯¸ë¦¬ DB ì—°ê²°ì„ ì—¬ëŸ¬ ê°œ ë§Œë“¤ì–´ ë†“ê³ &quot;</strong> ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œë§ˆë‹¤ ê·¸ ì¤‘ í•˜ë‚˜ë¥¼ ë¹Œë ¤ì£¼ëŠ” êµ¬ì¡°ë¡œ ì§„í–‰ëœë‹¤.</p>
<ul>
<li>Spring Boot ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ <strong><code>HikariCP</code></strong>ë¥¼ í†µí•´ ì»¤ë„¥ì…˜ í’€ì„ ê´€ë¦¬í•œë‹¤.</li>
</ul>
<h3 id="ğŸ¯ì»¤ë„¥ì…˜-í’€ì˜-ë™ì‘-êµ¬ì¡°">ğŸ¯ì»¤ë„¥ì…˜ í’€ì˜ ë™ì‘ êµ¬ì¡°</h3>
<ol>
<li>ì„œë²„ ì‹œì‘ ì‹œ DBì™€ ì—°ê²°ëœ ì»¤ë„¥ì…˜ Nê°œ ìƒì„±</li>
<li>ì‚¬ìš©ìê°€ API ìš”ì²­ (ex /user/update)</li>
<li><code>HikariCP</code>ê°€ ì»¤ë„¥ì…˜ í’€ì—ì„œ ë‚¨ëŠ” ì»¤ë„¥ì…˜ 1ê°œë¥¼ ë¹Œë ¤ì¤Œ</li>
<li>íŠ¸ëœì­ì…˜ ì™„ë£Œ ì‹œ -&gt; ì»¤ë„¥ì…˜ ë°˜í™˜</li>
<li>ë‹¤ì‹œ ë‹¤ë¥¸ ìš”ì²­ì—ì„œ ê·¸ ì»¤ë„¥ì…˜ì„ ì¬ì‚¬ìš©</li>
</ol>
<h3 id="ğŸš¨ë¬¸ì œ-ìƒí™©-ë‚™ê´€ì -ë³‘í–‰ì œì–´-ì‹¤íŒ¨-ì˜ˆì™¸--ì»¤ë„¥ì…˜-ê³ ê°ˆ">ğŸš¨ë¬¸ì œ ìƒí™©: ë‚™ê´€ì  ë³‘í–‰ì œì–´ ì‹¤íŒ¨ ì˜ˆì™¸ &amp; ì»¤ë„¥ì…˜ ê³ ê°ˆ</h3>
<p><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></p>
<ol>
<li><code>user.setFavoriteDrinks()</code> ë‚´ì—ì„œ ì‚­ì œ, ì‚½ì… ëŒ€ëŸ‰ ì—°ì‚° ìˆ˜í–‰</li>
<li>ë™ì‹œì— ìˆ˜ë°±~ìˆ˜ì²œ ê°œì˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìš”ì²­</li>
<li>ê° ìš”ì²­ë§ˆë‹¤ DB íŠ¸ëœì­ì…˜ì´ ëë‚˜ì§€ ì•Šê³  <strong>ì»¤ë„¥ì…˜ì„ ì ìœ </strong></li>
<li>ì»¤ë„¥ì…˜ í’€ì´ ê°€ë“ ì°¸ -&gt; ë‹¤ë¥¸ ìš”ì²­ì€ ëŒ€ê¸°í•˜ê±°ë‚˜ ì‹¤íŒ¨</li>
<li>ë‹¤ë¥¸ Get API ë„ DB ì—°ê²° ëª»í•´ì„œ ì‘ë‹µ ì§€ì—°, ì‹¬í•˜ë©´ 500 ì—ëŸ¬ ë°œìƒ</li>
</ol>
<h3 id="ğŸ’€í•´ê²°-ì‹œë„">ğŸ’€í•´ê²° ì‹œë„</h3>
<h4 id="1-ëª…ì‹œì -flush">1. ëª…ì‹œì  flush</h4>
<p>clear() í›„ flush ë¥¼ í†µí•´ DBì— ì¦‰ì‹œ ë°˜ì˜, ê·¸ í›„ ìƒˆë¡œìš´ ê°’ ì¶”ê°€</p>
<pre><code class="language-java">// domain/user/model/User.java
public void setFavoriteDrinks(List&lt;UserFavoriteDrinkType&gt; favorites, Runnable flushHandler) {
        this.favoriteDrinks.clear(); // ê¸°ì¡´ ê´€ê³„ ì œê±°
        flushHandler.run();
        this.favoriteDrinks.addAll(favorites);
    }</code></pre>
<pre><code class="language-java">// domain/user/service/UserCaffeineInfoService.update

if (!favoriteDrinkTypes.isEmpty()) {
                user.setFavoriteDrinks(favoriteDrinkTypes, () -&gt; userRepository.saveAndFlush(user));
            }</code></pre>
<p><img alt="" src="https://velog.velcdn.com/images/gmltn9233/post/3731ad87-9400-4413-8674-87d8ccc0bda7/image.png" /></p>
<p>ì—¬ì „íˆ ì˜¤ë¥˜ ë°œìƒ..</p>
<h4 id="2">2.</h4>